% ============================================================================
%  PZ document: основной файл для компиляции документа "Пояснительная записка".
% ============================================================================
% arara: xelatex
% arara: biber
% arara: xelatex: { synctex: true }

\documentclass[12pt,a4paper,oneside,final]{report}

% --- Подключение шаблона ----------------------------------------------------
\input{template/preamble/thesis-template-macro}

% --- Настройки для ПЗ --------------------------------------------------------
% В ПЗ аннотации разделов и подразделов не показываются (в отличие от РСПЗ)
\showannotationsfalse

% --- Подключение содержимого задания ---------------------------------------
% Необходимо для включения листа задания в документ
\input{content/1-main-content/01-task-content}

\begin{document}

% --- Титульный лист ПЗ -------------------------------------------------------
% Условная вставка: либо готовый PDF, либо LaTeX-верстка
\ifusepdfPzTitle
    \includepdf[pages={-}, offset=0mm -0mm]{\pztitlepdf}
\else
    \input{template/titles/3-pz-title}
\fi
\newpage

% --- Дополнительный лист с подписями для ВКР --------------------------------
% Раскомментируйте, если требуется включить дополнительный лист с подписями
% (например, для ВКР на кафедре 22)
% \clearpage
% \includepdf[pages={-}, offset=0mm -0mm]{3-titles/title-dep22.pdf}
% \clearpage

% --- Лист задания -----------------------------------------------------------
% Условная вставка: либо готовый PDF, либо LaTeX-верстка
\ifusepdfTaskSheet
    \includepdf[pages={-}, offset=0mm -0mm]{\tasktitlepdf}
\else
    \input{template/titles/1-task-title}
\fi
\newpage

% --- Настройка нумерации страниц --------------------------------------------
\pagestyle{plain}
\pagenumbering{arabic}
\setcounter{page}{2}

% --- Основное содержимое документа -------------------------------------------
% Используется отдельная refsection для изоляции библиографии ПЗ
\refsection

% --- Место для отчета Антиплагиата ------------------------------------------
% Раскомментируйте, если требуется вставить страницы с отчетом Антиплагиата
% \clearpage
% \thispagestyle{empty}
% \vfill
% \begin{center}
% [Место для распечатки отчета Антиплагиата]
% \end{center}
% \newpage
% \thispagestyle{empty}
% \vfill
% \begin{center}
% [Место для распечатки отчета Антиплагиата]
% \end{center}

\clearpage

\input{content/1-main-content/02-abstract}

\clearpage

\input{content/1-main-content/03-toc}

\clearpage

\input{content/1-main-content/04-intro}

\clearpage

\input{content/1-main-content/05-chapter-1}

\clearpage

\input{content/1-main-content/06-chapter-2}

\clearpage

\input{content/1-main-content/07-chapter-3}

\clearpage

\input{content/1-main-content/08-chapter-4}

\clearpage

\input{content/1-main-content/09-chapter-5}

\clearpage

\input{content/1-main-content/10-conclusion}

% --- Подсчет общих счетчиков для реферата -----------------------------------
% Сохраняем значения счетчиков перед библиографией для использования в реферате
\setcounter{totalfigures}{\the\value{totalfigures}+\the\value{figure}}
\setcounter{figure}{0}
\setcounter{totaltables}{\the\value{totaltables}+\the\value{table}}
\setcounter{table}{0}
\setcounter{totallistings}{\the\value{totallistings}+\the\value{lstlisting}}
\setcounter{lstlisting}{0}

% Создаем метки для ссылок на общее количество фигур, таблиц и листингов
\makeatletter
\edef\@currentlabel{\the\value{totalfigures}}
\label{figures}
\edef\@currentlabel{\the\value{totaltables}}
\label{tables}
\edef\@currentlabel{\the\value{totallistings}}
\label{listings}
\makeatother

% --- Список использованной литературы ----------------------------------------
\clearpage

\input{content/1-main-content/11-bibliography}

\endrefsection

\label{end_of_main_text}

% --- Приложения --------------------------------------------------------------
\clearpage
\label{sec:appendices}

\begin{appendices}
    \chapter*{Приложения}
    \addcontentsline{toc}{chapter}{Приложения}

    % --- Переопределение команд для приложений -------------------------------
    % Изменяем поведение глав, разделов и подразделов для корректного
    % попадания в оглавление и нумерации приложений буквами
    \let\oldchapter\chapter
    \renewcommand{\thechapter}{\Asbuk{chapter}}
    \renewcommand{\chapter}[1]{%
        \refstepcounter{chapter}%
        \oldchapter*{\appendixname~\thechapter.~#1}%
        \addcontentsline{toc}{section}{\appendixname~\thechapter.~#1}%
        \stepcounter{totalappendices}%
    }

    \let\oldsection\section
    \renewcommand{\section}[1]{
        \stepcounter{section}%
        \oldsection*{\thesection~#1}%
    }
    \let\oldsubsection\subsection
    \renewcommand{\subsection}[1]{
        \stepcounter{subsection}
        \oldsubsection*{\thesubsection~#1}
    }

    % --- Отключение переноса первого приложения ------------------------------
    % Первое приложение не переносится на новую страницу
    \makeatletter
    \let\oldclearpage\clearpage
    \let\clearpage\relax
    \makeatother

    % Подключение всех приложений
    \input{content/2-appendices/_all-appendices}

    % --- Восстановление стандартного поведения ------------------------------
    % Восстанавливаем все команды как было до переопределения
    \let\chapter\oldchapter
    \let\section\oldsection
    \let\subsection\oldsubsection
\end{appendices}

\label{end_of_document}

\end{document}

